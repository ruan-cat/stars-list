# GitHub Actions 工作流：自动更新 awesome-stars 列表
# 此工作流会定期运行 starred 工具来生成和更新 GitHub stars 的分类列表
name: update awesome-stars

# 触发条件
on:
  # 手动触发选项（可在 GitHub Actions 页面手动运行）
  workflow_dispatch:
  # 定时任务：每天 UTC 时间 00:30 自动执行
  schedule:
    - cron: "30 0 * * *"

jobs:
  awesome-stars:
    name: update awesome-stars
    runs-on: ubuntu-latest

    steps:
      # 检出代码仓库
      - uses: actions/checkout@v3

      # 配置 Python 环境
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      # 安装依赖包
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install starred

      # 获取当前仓库名称并设置为环境变量
      - name: get repository name
        run: echo "REPOSITORY_NAME=${GITHUB_REPOSITORY#*/}" >> $GITHUB_ENV

      # 按编程语言分类更新 stars 列表
      - name: update repo category by language
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          REPOSITORY: ${{ env.REPOSITORY_NAME }}
          USERNAME: ${{ github.repository_owner }}
        run: |
          starred \
            --username "${USERNAME}" \
            --repository "${REPOSITORY}" \
            --sort \
            --token "${GITHUB_TOKEN}" \
            --message "awesome-stars category by language update by github actions cron, created by starred"

      # 按主题分类更新 stars 列表
      - name: update repo category by topic
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          REPOSITORY: ${{ env.REPOSITORY_NAME }}
          USERNAME: ${{ github.repository_owner }}
        run: |
          starred \
            --username "${USERNAME}" \
            --repository "${REPOSITORY}" \
            --sort \
            --token "${GITHUB_TOKEN}" \
            --message "awesome-stars category by topic update by github actions cron, created by starred" \
            --topic \
            --topic_limit 500 \
            --filename docs/topics.md
